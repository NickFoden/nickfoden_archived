{"componentChunkName":"component---src-templates-post-tsx","path":"/app-engine-environment-variables/","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiUlEQVQI1y3OSwsBURgG4NmQwspSSRZW1KyQey6xoKQkkmz9Cv98xvPVmXrm/c4537lkZVl+qTGiQ4Mu45jPfEVRDNUverRopvmJOqdKPWR+P84W13Iv93Gg/MhHbJTLWGOQ+g6cUv3mxpFnNC+Yc2WlaUNffYmLqBjn6fVttsa7dGj0xr47M6Z/oPq24mK2nJwAAAAASUVORK5CYII=","width":198,"height":28,"src":"/static/d92dba554be1b7e5cbeab9eb3e08d355/44465/NickFoden.png","srcSet":"/static/d92dba554be1b7e5cbeab9eb3e08d355/44465/NickFoden.png 1x"}}},"markdownRemark":{"html":"<p>TLDR: Cloud Build + <code class=\"language-text\">printenv</code></p>\n<p>** this post is about a NodeJS deployment</p>\n<p>When working with app engine, you can setup an automated deployment with cloud build. This works well for creating your own CICD pipeline. I hit some bumps with wanting to supply different <code class=\"language-text\">env</code> vars for prod that had to be obfuscated. </p>\n<p>To deploy on app engine you will need to add <code class=\"language-text\">app.yaml</code> in the root of your project</p>\n<p> <a href=\"https://cloud.google.com/appengine/docs/flexible/nodejs/configuring-your-app-with-app-yaml\">https://cloud.google.com/appengine/docs/flexible/nodejs/configuring-your-app-with-app-yaml</a></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// my app.yaml below</span>\n<span class=\"token comment\">// this is actually a real simple file for the standard environment that will scale to zero</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"># Copyright <span class=\"token number\">2017</span><span class=\"token punctuation\">,</span> Google<span class=\"token punctuation\">,</span> Inc<span class=\"token punctuation\">.</span>\n# Licensed under the Apache License<span class=\"token punctuation\">,</span> Version <span class=\"token number\">2.0</span> <span class=\"token punctuation\">(</span>the <span class=\"token string\">\"License\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n# you may not use <span class=\"token keyword\">this</span> file except <span class=\"token keyword\">in</span> compliance <span class=\"token keyword\">with</span> the License<span class=\"token punctuation\">.</span>\n# You may obtain a copy <span class=\"token keyword\">of</span> the License at\n#\n#    http<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>www<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>org<span class=\"token operator\">/</span>licenses<span class=\"token operator\">/</span><span class=\"token constant\">LICENSE</span><span class=\"token operator\">-</span><span class=\"token number\">2.0</span>\n#\n# Unless required by applicable law or agreed to <span class=\"token keyword\">in</span> writing<span class=\"token punctuation\">,</span> software\n# distributed under the License is distributed on an <span class=\"token string\">\"AS IS\"</span> <span class=\"token constant\">BASIS</span><span class=\"token punctuation\">,</span>\n# <span class=\"token constant\">WITHOUT</span> <span class=\"token constant\">WARRANTIES</span> <span class=\"token constant\">OR</span> <span class=\"token constant\">CONDITIONS</span> <span class=\"token constant\">OF</span> <span class=\"token constant\">ANY</span> <span class=\"token constant\">KIND</span><span class=\"token punctuation\">,</span> either express or implied<span class=\"token punctuation\">.</span>\n# See the License <span class=\"token keyword\">for</span> the specific language governing permissions and\n# limitations under the License<span class=\"token punctuation\">.</span>\n\n# <span class=\"token punctuation\">[</span><span class=\"token constant\">START</span> gae_quickstart_yaml<span class=\"token punctuation\">]</span>\nruntime<span class=\"token operator\">:</span> nodejs14\n# <span class=\"token punctuation\">[</span><span class=\"token constant\">END</span> gae_quickstart_yaml<span class=\"token punctuation\">]</span></code></pre></div>\n<p>And then after you setup cloudbuild will have another yaml file\n<code class=\"language-text\">cloudbuild.yaml</code></p>\n<p><a href=\"https://cloud.google.com/build/docs/set-up\">https://cloud.google.com/build/docs/set-up</a></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// example of a cloudbuild.yaml below</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">steps<span class=\"token operator\">:</span>\n  <span class=\"token operator\">-</span> name<span class=\"token operator\">:</span> node\n    entrypoint<span class=\"token operator\">:</span> npm\n    args<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"run\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"create-env\"</span><span class=\"token punctuation\">]</span>\n    env<span class=\"token operator\">:</span>\n      <span class=\"token operator\">-</span> <span class=\"token string\">'MYSQL_HOST=${_MYSQL_HOST}'</span>\n      <span class=\"token operator\">-</span> <span class=\"token string\">'MYSQL_DATABASE=${_MYSQL_DATABASE}'</span>\n      <span class=\"token operator\">-</span> <span class=\"token string\">'MYSQL_USERNAME=${_MYSQL_USERNAME}'</span>\n      <span class=\"token operator\">-</span> <span class=\"token string\">'MYSQL_PASSWORD=${_MYSQL_PASSWORD}'</span>\n      <span class=\"token operator\">-</span> <span class=\"token string\">'MYSQL_PORT=${_MYSQL_PORT}'</span>\n  <span class=\"token operator\">-</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"gcr.io/cloud-builders/gcloud\"</span>\n    args<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"app\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"deploy\"</span><span class=\"token punctuation\">]</span>\n    timeout<span class=\"token operator\">:</span> <span class=\"token string\">\"1600s\"</span></code></pre></div>\n<p>So this cloudbuild file has some default stuff, but also i added the <code class=\"language-text\">env</code> values. So this is what we want to swap in at build time. And Cloud Build will require you name your env variables starting with an underscore <code class=\"language-text\">_A_VALUE</code>. </p>\n<p>And quick note that you can see in the cloudbuild file i added a first step and i named it node, which could be improved, but the args are important <code class=\"language-text\">run create-env</code> and so in my <code class=\"language-text\">package.json</code> this will use <code class=\"language-text\">printenv</code> to print the environment variables to a file <code class=\"language-text\">.env</code> before building the project. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token string\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsc --project ./\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"create-env\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"printenv > .env\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nodemon server.ts\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"gcp-build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsc --project ./\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node ./build/server.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"validate\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsc --noEmit\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Notice the <code class=\"language-text\">gcp-build</code> script in my package file as well. This is an important script that GCP will run to build your app. </p>\n<p>So now you can go to your cloud build job in the gcp console and setup your <code class=\"language-text\">.env</code> vars for prod and cloud build will add a <code class=\"language-text\">.env</code> file to your project when building with the variables. </p>\n<p>This is the first draft of this post. Thinking to use some more examples of screenshots of the gcp cloud console, but need to setup an example project that i donâ€™t mind exposing first. </p>\n<p>Any questions hit me up, also i can configure your build pipeline for $ :-). This was an annoying thing, but once i discovered <code class=\"language-text\">printenv</code> command it all clicked. </p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TLDR: Cloud Build + "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"printenv"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"** this post is about a NodeJS deployment"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When working with app engine, you can setup an automated deployment with cloud build. This works well for creating your own CICD pipeline. I hit some bumps with wanting to supply different "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"env"}]},{"type":"text","value":" vars for prod that had to be obfuscated. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To deploy on app engine you will need to add "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"app.yaml"}]},{"type":"text","value":" in the root of your project"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":" "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/appengine/docs/flexible/nodejs/configuring-your-app-with-app-yaml"},"children":[{"type":"text","value":"https://cloud.google.com/appengine/docs/flexible/nodejs/configuring-your-app-with-app-yaml"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// my app.yaml below"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// this is actually a real simple file for the standard environment that will scale to zero"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"# Copyright "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2017"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Google"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Inc"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n# Licensed under the Apache License"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Version "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2.0"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"the "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"License\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n# you may not use "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"text","value":" file except "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":" compliance "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"with"}]},{"type":"text","value":" the License"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n# You may obtain a copy "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"of"}]},{"type":"text","value":" the License at\n#\n#    http"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"www"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"apache"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"org"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"licenses"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"LICENSE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2.0"}]},{"type":"text","value":"\n#\n# Unless required by applicable law or agreed to "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":" writing"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" software\n# distributed under the License is distributed on an "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"AS IS\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"BASIS"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n# "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"WITHOUT"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"WARRANTIES"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"CONDITIONS"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"OF"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"ANY"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"KIND"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" either express or implied"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n# See the License "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" the specific language governing permissions and\n# limitations under the License"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n\n# "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"START"}]},{"type":"text","value":" gae_quickstart_yaml"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\nruntime"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" nodejs14\n# "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"END"}]},{"type":"text","value":" gae_quickstart_yaml"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And then after you setup cloudbuild will have another yaml file\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"cloudbuild.yaml"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/build/docs/set-up"},"children":[{"type":"text","value":"https://cloud.google.com/build/docs/set-up"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// example of a cloudbuild.yaml below"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"steps"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" name"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" node\n    entrypoint"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" npm\n    args"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"run\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"create-env\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n    env"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'MYSQL_HOST=${_MYSQL_HOST}'"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'MYSQL_DATABASE=${_MYSQL_DATABASE}'"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'MYSQL_USERNAME=${_MYSQL_USERNAME}'"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'MYSQL_PASSWORD=${_MYSQL_PASSWORD}'"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'MYSQL_PORT=${_MYSQL_PORT}'"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" name"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"gcr.io/cloud-builders/gcloud\""}]},{"type":"text","value":"\n    args"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"app\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"deploy\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n    timeout"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"1600s\""}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So this cloudbuild file has some default stuff, but also i added the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"env"}]},{"type":"text","value":" values. So this is what we want to swap in at build time. And Cloud Build will require you name your env variables starting with an underscore "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"_A_VALUE"}]},{"type":"text","value":". "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And quick note that you can see in the cloudbuild file i added a first step and i named it node, which could be improved, but the args are important "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"run create-env"}]},{"type":"text","value":" and so in my "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"package.json"}]},{"type":"text","value":" this will use "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"printenv"}]},{"type":"text","value":" to print the environment variables to a file "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":".env"}]},{"type":"text","value":" before building the project. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"  "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"scripts\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"build\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"tsc --project ./\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"create-env\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"printenv > .env\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"dev\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"nodemon server.ts\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"gcp-build\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"tsc --project ./\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"start\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"node ./build/server.js\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"validate\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"tsc --noEmit\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Notice the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"gcp-build"}]},{"type":"text","value":" script in my package file as well. This is an important script that GCP will run to build your app. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So now you can go to your cloud build job in the gcp console and setup your "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":".env"}]},{"type":"text","value":" vars for prod and cloud build will add a "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":".env"}]},{"type":"text","value":" file to your project when building with the variables. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is the first draft of this post. Thinking to use some more examples of screenshots of the gcp cloud console, but need to setup an example project that i donâ€™t mind exposing first. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Any questions hit me up, also i can configure your build pipeline for $ :-). This was an annoying thing, but once i discovered "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"printenv"}]},{"type":"text","value":" command it all clicked. "}]}],"data":{"quirksMode":false}},"excerpt":"TLDR: Cloud Build +  ** this post is about a NodeJS deployment When working with app engine, you can setup an automated deployment withâ€¦","timeToRead":2,"frontmatter":{"title":"Environment Variables for Google App Engine","userDate":"20 April 2021","date":"2021-04-20T10:00:00.000Z","tags":["GoogleCloud","AppEngine","CloudBuild","NodeJS"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABQ0lEQVQY02P4////8dv/M+f/z1rwP23u/2l7gAL///0DITADTGFjAAHDt5//o6f+1Sz9mzP/r33Tb6Oqf0dugqT/ItTgBAzzDvwxrvqVNvt35/qPVUs/2tT/SJzx+/ff/x8/vH/16vXXr18/fvz448eP+/fvv3v37vPnzx8+fHj16tWXL18+ffrE4NX5PWryt+nbPzWseLfs0OeqJR+MKr6cvvf/5dN7+/YfvHz58vHjx589e3bhwoU7d+6cPn366tWrQPLixYtAcYZFh34al39KmPx23u4PdUvfGBU+SJj08tfv/3///nn79i3QkufPn//58wdoD5B88eLFzZs3f//+/fPnT6CLGH78+pcw7bNpxQe76mdmxfdMi+4du/4N5Oe/RPgZiA9d++nf8T6s76NHw+OWFS8hoQ0PW0jwIgcyXAoAehhrcpcU9ukAAAAASUVORK5CYII=","aspectRatio":2.8615384615384616,"src":"/static/de23320a65e52001c389fe8eaba459e5/b9329/GoogleAppEngine.png","srcSet":"/static/de23320a65e52001c389fe8eaba459e5/c5c6c/GoogleAppEngine.png 930w,\n/static/de23320a65e52001c389fe8eaba459e5/b9329/GoogleAppEngine.png 993w","sizes":"(max-width: 993px) 100vw, 993px"}}},"author":{"id":"NickFoden","bio":"Excited about JS","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQADAAAAAAAAAAAAAAAAAAQCAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABr1TSFyRZzwZA/8QAGxAAAgIDAQAAAAAAAAAAAAAAAQMAAgQQEhH/2gAIAQEAAQUC9XaE0ELFyzuVjIPZbCd//8QAFhEBAQEAAAAAAAAAAAAAAAAAIQAQ/9oACAEDAQE/ASN//8QAFhEBAQEAAAAAAAAAAAAAAAAAIQAQ/9oACAECAQE/AWd//8QAHBAAAgEFAQAAAAAAAAAAAAAAAAEhAhEgIjJh/9oACAEBAAY/AoqR0jo1U2H7j//EABsQAQADAAMBAAAAAAAAAAAAAAEAESEQMUGB/9oACAEBAAE/Ia2/7NlCXMEMaDoyXJMFQF8iJrAOP//aAAwDAQACAAMAAAAQvNd+/8QAFREBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQMBAT8QDD//xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAgEBPxAYv//EABsQAQADAQEBAQAAAAAAAAAAAAEAESExQWGR/9oACAEBAAE/EC1xfIy2fWJNvPLgQlOR2ovJBF2CHQ5ssSfiUdEogkTpO9n/2Q==","width":400,"height":400,"src":"/static/3caa4dd63b029e650cad7fd0d7c5e503/64b17/meandhenry.jpg","srcSet":"/static/3caa4dd63b029e650cad7fd0d7c5e503/64b17/meandhenry.jpg 1x,\n/static/3caa4dd63b029e650cad7fd0d7c5e503/39f27/meandhenry.jpg 1.5x,\n/static/3caa4dd63b029e650cad7fd0d7c5e503/a1eb1/meandhenry.jpg 2x"}}]}}}},"relatedPosts":{"totalCount":1,"edges":[{"node":{"id":"8034dad8-f3ce-5863-bb4d-ab74dbb94f1a","timeToRead":2,"excerpt":"TLDR: Cloud Build +  ** this post is about a NodeJS deployment When working with app engine, you can setup an automated deployment withâ€¦","frontmatter":{"title":"Environment Variables for Google App Engine"},"fields":{"slug":"/app-engine-environment-variables/"}}}]}},"pageContext":{"slug":"/app-engine-environment-variables/","prev":{"excerpt":"The right tool for the right job Thinking this morning about all the options / paths to building for the web, and the differing opinionsâ€¦","timeToRead":1,"frontmatter":{"title":"The Modern Web","tags":["React","Web","HTML"],"date":"2021-01-27T10:00:00.000Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.2317880794701987,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAFMNcs0oyJ//8QAGxAAAgEFAAAAAAAAAAAAAAAAAQMSAAQQESH/2gAIAQEAAQUCdEsxc6DZcNf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAABBAMAAAAAAAAAAAAAAAAQAAERISIxQf/aAAgBAQAGPwLHRpq4oH//xAAaEAEBAQEAAwAAAAAAAAAAAAABABExIUFR/9oACAEBAAE/IU/QL7J4kNuFADic+4Qlrf/aAAwDAQACAAMAAAAQYA//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxBn/8QAFREBAQAAAAAAAAAAAAAAAAAAEDH/2gAIAQIBAT8Qh//EABwQAAIDAQADAAAAAAAAAAAAAAERACExcUFRYf/aAAgBAQABPxAPsq2DQGeWYcOhgORhcNdRAIM372NQQAR6TvsIwHtT/9k=","sizes":"(max-width: 3720px) 100vw, 3720px","src":"/static/3428cb928543eb01ad9e127fe6985484/61e04/todd-quackenbush-IClZBVw5W5A-unsplash.jpg","srcSet":"/static/3428cb928543eb01ad9e127fe6985484/2f037/todd-quackenbush-IClZBVw5W5A-unsplash.jpg 930w,\n/static/3428cb928543eb01ad9e127fe6985484/23f4e/todd-quackenbush-IClZBVw5W5A-unsplash.jpg 1860w,\n/static/3428cb928543eb01ad9e127fe6985484/61e04/todd-quackenbush-IClZBVw5W5A-unsplash.jpg 3720w,\n/static/3428cb928543eb01ad9e127fe6985484/abf43/todd-quackenbush-IClZBVw5W5A-unsplash.jpg 5580w,\n/static/3428cb928543eb01ad9e127fe6985484/02890/todd-quackenbush-IClZBVw5W5A-unsplash.jpg 5663w"}}},"author":{"id":"NickFoden","bio":"Excited about JS","avatar":{"children":[{"fixed":{"src":"/static/3caa4dd63b029e650cad7fd0d7c5e503/64b17/meandhenry.jpg"}}]}}},"fields":{"layout":"post","slug":"/modern-web/"}},"next":{"excerpt":"WAIT WHAT? No code comments ? What the heck, Nick has lost it.   Think we are all taught / learn / assume that code comments are great. Theyâ€¦","timeToRead":1,"frontmatter":{"title":"Dont comment your code","tags":["Code","BestPractices"],"date":"2022-01-25T10:00:00.000Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.5321252059308073,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABzCiVD//EABgQAAIDAAAAAAAAAAAAAAAAAAABESAh/9oACAEBAAEFAqLSD//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/AUf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAdEAACAgEFAAAAAAAAAAAAAAAAARFBIVFxgZGh/9oACAEBAAE/IeDZGNH2WLKJJK/D/9oADAMBAAIAAwAAABCL3//EABYRAAMAAAAAAAAAAAAAAAAAAAEQYf/aAAgBAwEBPxARP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/EFf/xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMUGB/9oACAEBAAE/EAL10eXKxUH7ABrQDRvsVMK9CcFWP//Z","sizes":"(max-width: 3720px) 100vw, 3720px","src":"/static/4da92e1bcad0d2d372b228babbf664ea/61e04/markus-spiske-cvBBO4PzWPg-unsplash.jpg","srcSet":"/static/4da92e1bcad0d2d372b228babbf664ea/2f037/markus-spiske-cvBBO4PzWPg-unsplash.jpg 930w,\n/static/4da92e1bcad0d2d372b228babbf664ea/23f4e/markus-spiske-cvBBO4PzWPg-unsplash.jpg 1860w,\n/static/4da92e1bcad0d2d372b228babbf664ea/61e04/markus-spiske-cvBBO4PzWPg-unsplash.jpg 3720w,\n/static/4da92e1bcad0d2d372b228babbf664ea/abf43/markus-spiske-cvBBO4PzWPg-unsplash.jpg 5580w,\n/static/4da92e1bcad0d2d372b228babbf664ea/26f50/markus-spiske-cvBBO4PzWPg-unsplash.jpg 5688w"}}},"author":{"id":"NickFoden","bio":"Excited about JS","avatar":{"children":[{"fixed":{"src":"/static/3caa4dd63b029e650cad7fd0d7c5e503/64b17/meandhenry.jpg"}}]}}},"fields":{"layout":"post","slug":"/dont-comment-code/"}},"primaryTag":"GoogleCloud"}},"staticQueryHashes":["1917415651","2243855231","794779027"]}